Base del proyecto RSE:

1ï¸âƒ£ ActualizaciÃ³n del sistema

Siempre el primer paso (y mencionable en la memoria):

sudo apt update && sudo apt upgrade -y
sudo reboot

2ï¸âƒ£ Paquetes base y dependencias comunes

sudo apt install -y \
  git curl wget vim \
  python3 python3-pip \
  build-essential \
  software-properties-common

Esto \ significa que va todo en una lÃ­nea de comando

Comprobar:

python3 --version
pip3 --version

3ï¸âƒ£ InstalaciÃ³n de Mininet

Mininet se usarÃ¡ a partir del Hito 2, pero se instala aquÃ­.

sudo apt install -y mininet openvswitch-switch

VerificaciÃ³n:

sudo mn --test pingall

âœ… Si los hosts se hacen ping â†’ Mininet funciona.

4ï¸âƒ£ InstalaciÃ³n de Suricata (IDS)

Ubuntu 22.04 trae una versiÃ³n estable suficiente para el proyecto.

sudo apt install -y suricata

Comprobad versiÃ³n:

suricata -V

(Tiene que salir la 6.0.4)

Comprobar estado del servicio

sudo systemctl status suricata

Si no estÃ¡ activo:

sudo systemctl enable suricata
sudo systemctl start suricata

Si hay errores hacer esto:

Edita el archivo principal:

sudo nano /etc/suricata/suricata.yaml

Busca la secciÃ³n af-packet (usa CTRL+W y escribe af-packet).

VerÃ¡s algo parecido a esto:

af-packet:
  - interface: eth0

ðŸ”´ Ese eth0 suele ser el problema
CÃ¡mbialo por tu interfaz real

Ejemplo:

af-packet:
  - interface: enp0s3

Guarda y sal

ANTES de arrancar el servicio, valida:

sudo suricata -T -c /etc/suricata/suricata.yaml

Resultado esperado:

Configuration provided was successfully loaded

Si aÃºn falla:

Paso 1 â€“ Ver si existen reglas

Ejecuta:

ls -l /etc/suricata/rules/

Ejecuta como root:

sudo suricata-update

(Tarda lo suyo)

Ejecuta:

ls -l /var/lib/suricata/rules/

DeberÃ­as ver:

suricata.rules

Edita:

sudo nano /etc/suricata/suricata.yaml

Busca:

default-rule-path: /etc/suricata/rules

Y cÃ¡mbialo por:

default-rule-path: /var/lib/suricata/rules

Luego, un poco mÃ¡s abajo, asegÃºrate de que estÃ© asÃ­:

rule-files:
  - suricata.rules

sudo suricata -T -c /etc/suricata/suricata.yaml

âœ… Resultado correcto:

Configuration provided was successfully loaded

Arrancar el servicio definitivamente

sudo systemctl restart suricata
sudo systemctl status suricata

Debe salir:

Active: active (running)

5ï¸âƒ£ InstalaciÃ³n de Prometheus (base de datos de mÃ©tricas)

Prometheus NO viene en repos oficiales, lo instalamos desde binario (forma estÃ¡ndar).
ðŸ”¹ Paso 5.1 â€“ Crear usuario para Prometheus (buena prÃ¡ctica)

sudo useradd --no-create-home --shell /bin/false prometheus

ðŸ”¹ Paso 5.2 â€“ Descargar Prometheus

cd /tmp
wget https://github.com/prometheus/prometheus/releases/download/v2.49.1/prometheus-2.49.1.linux-amd64.tar.gz

Descomprimir:

tar xvf prometheus-2.49.1.linux-amd64.tar.gz

Mover binarios:

sudo mv prometheus-2.49.1.linux-amd64/prometheus /usr/local/bin/
sudo mv prometheus-2.49.1.linux-amd64/promtool /usr/local/bin/

Permisos:

sudo chown prometheus:prometheus /usr/local/bin/prometheus
sudo chown prometheus:prometheus /usr/local/bin/promtool

ðŸ”¹ Paso 5.3 â€“ Directorios de configuraciÃ³n y datos

sudo mkdir /etc/prometheus
sudo mkdir /var/lib/prometheus

sudo chown prometheus:prometheus /etc/prometheus
sudo chown prometheus:prometheus /var/lib/prometheus

Copiar archivos base:

sudo mv prometheus-2.49.1.linux-amd64/consoles /etc/prometheus
sudo mv prometheus-2.49.1.linux-amd64/console_libraries /etc/prometheus

ðŸ”¹ Paso 5.4 â€“ ConfiguraciÃ³n bÃ¡sica de Prometheus

Crear archivo:

sudo nano /etc/prometheus/prometheus.yml

Contenido mÃ­nimo:

global:
  scrape_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

Permisos:

sudo chown prometheus:prometheus /etc/prometheus/prometheus.yml

ðŸ”¹ Paso 5.5 â€“ Crear servicio systemd

sudo nano /etc/systemd/system/prometheus.service

Contenido:

[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.path=/var/lib/prometheus/

[Install]
WantedBy=multi-user.target

Activar servicio:

sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus

Comprobar:

sudo systemctl status prometheus

Acceso web:

http://localhost:9090

6ï¸âƒ£ InstalaciÃ³n de Grafana

Grafana no viene en repos oficiales, hay que aÃ±adirlos.

- Paso 6.1 â€” Descargar Grafana

cd /tmp
wget https://dl.grafana.com/enterprise/release/grafana-enterprise_11.4.0_amd64.deb

- Paso 6.2 â€” Instalar Grafana

sudo dpkg -i grafana-enterprise_11.4.0_amd64.deb

Si da error de dependencias:

sudo apt-get install -f -y

- Paso 6.3 â€” Habilitar e iniciar servicio

sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server

Verificar:

sudo systemctl status grafana-server

âœ… Resultado esperado:

Active: active (running)

ðŸ”¹ Paso 6.4 â€” Acceso web

Abrir navegador:

firefox http://localhost:3000 &

Credenciales por defecto:
- Usuario: admin
- ContraseÃ±a: admin

Te pedirÃ¡ cambiar la contraseÃ±a â†’ Elegir una que recuerdes

ðŸ”¹ Paso 6.5 â€” Conectar Prometheus a Grafana

En Grafana web:
1. MenÃº lateral â†’ âš™ï¸ Settings (o Connections)
2. Data Sources
3. Add data source
4. Seleccionar "Prometheus"
5. URL: http://localhost:9090
6. Scroll down â†’ Save & Test

âœ… Resultado: "Data source is working"

ðŸ”¹ Paso 6.6 â€” Crear dashboard de prueba

1. MenÃº lateral â†’ Dashboards
2. New â†’ New Dashboard
3. Add visualization
4. Seleccionar "Prometheus"
5. En Metric: escribir "up"
6. Run query
7. DeberÃ­as ver grÃ¡fica mostrando valor 1 (Prometheus estÃ¡ up)
8. Save dashboard â†’ Darle un nombre

âœ… Si ves la grÃ¡fica â†’ Grafana + Prometheus funcionando correctamente


SecciÃ³n 7: Guest Additions (Portapapeles Bidireccional)

ðŸ”¹ Paso 7.1 â€” Configurar VirtualBox (VM apagada)

En VirtualBox â†’ ConfiguraciÃ³n de la VM:
- General â†’ Avanzado:
  âœ“ Portapapeles compartido: Bidireccional
  âœ“ Arrastrar y soltar: Bidireccional

ðŸ”¹ Paso 7.2 â€” Actualizar sistema (CRÃTICO)

âš ï¸ Hacer ANTES de instalar Guest Additions:

sudo apt update
sudo apt upgrade -y
sudo reboot

ðŸ”¹ Paso 7.3 â€” Instalar dependencias

sudo apt install -y \
    build-essential \
    dkms \
    linux-headers-$(uname -r) \
    perl

Verificar:

dpkg -l | grep build-essential
dpkg -l | grep dkms

ðŸ”¹ Paso 7.4 â€” Instalar Guest Additions desde CD

En VirtualBox (menÃº superior):
Dispositivos â†’ Insertar imagen de CD de las Guest Additions

En la terminal:

sudo mkdir -p /mnt/cdrom
sudo mount /dev/cdrom /mnt/cdrom
cd /mnt/cdrom
sudo sh ./VBoxLinuxAdditions.run --nox11

Esperar 1-3 minutos hasta que termine.

ðŸ”¹ Paso 7.5 â€” Reiniciar

sudo reboot

ðŸ”¹ Paso 7.7 â€” Probar portapapeles

âœ… Si funciona en ambas direcciones â†’ OK

ðŸ”¹ Paso 7.8 â€” Autostart (opcional)

Para que inicie automÃ¡ticamente:

mkdir -p ~/.config/autostart
cat > ~/.config/autostart/vboxclient.desktop << 'EOF'
[Desktop Entry]
Type=Application
Name=VirtualBox Guest Additions
Exec=sh -c 'VBoxClient --clipboard; VBoxClient --draganddrop; VBoxClient --seamless; VBoxClient --display'
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
EOF
chmod +x ~/.config/autostart/vboxclient.desktop

Ahora iniciarÃ¡ automÃ¡ticamente cada vez que arranques.

INSTALAR VISUAL:
/tmp

# Descargar VS Code
wget -O code.deb 'https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64'

# Instalar
sudo apt install ./code.deb -y

# Verificar
code --version


INSTALAR GitHub desktop:
wget -qO - https://mirror.mwt.me/shiftkey-desktop/gpgkey | gpg --dearmor | sudo tee /usr/share/keyrings/mwt-desktop.gpg > /dev/null
sudo sh -c 'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/mwt-desktop.gpg] https://mirror.mwt.me/shiftkey-desktop/deb/ any main" > /etc/apt/sources.list.d/mwt-desktop.list'

sudo apt update && sudo apt install github-desktop